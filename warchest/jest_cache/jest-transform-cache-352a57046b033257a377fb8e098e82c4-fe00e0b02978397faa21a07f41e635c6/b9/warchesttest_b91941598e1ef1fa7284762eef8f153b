e5cfc447dedffb463c8b556e3a02fd63
_getJestObj().mock('../../src/core/solana');
_getJestObj().mock('../../src/core/keychain');
function _getJestObj() {
  const {
    jest
  } = require("@jest/globals");
  _getJestObj = () => jest;
  return jest;
}
const warchest = require('../../src/core/warchest');
const eventBus = require('../../src/core/eventBus');
const {
  PrismaClient
} = require('@prisma/client');
describe('core warchest', () => {
  let prismaMock;
  beforeAll(() => {
    prismaMock = {
      wallet: {
        create: jest.fn().mockResolvedValue({
          name: 'name',
          publicKey: 'pk'
        }),
        findMany: jest.fn().mockResolvedValue([]),
        findUnique: jest.fn().mockResolvedValue({
          publicKey: 'pk'
        })
      }
    };
    PrismaClient.mockImplementation(() => prismaMock);
  });
  afterEach(() => {
    jest.clearAllMocks();
  });
  test('addWallet emits event and returns wallet', async () => {
    const solana = require('../../src/core/solana');
    solana.createWallet.mockResolvedValue({
      publicKey: 'pk',
      keychainRef: 'ref'
    });
    solana.getPrivateKey.mockResolvedValue('priv');
    const result = await warchest.addWallet('name');
    expect(result.publicKey).toBe('pk');
    expect(eventBus.emit).toHaveBeenCalledWith('wallet.add', {
      name: 'name',
      publicKey: 'pk'
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJqZXN0IiwicmVxdWlyZSIsIndhcmNoZXN0IiwiZXZlbnRCdXMiLCJQcmlzbWFDbGllbnQiLCJkZXNjcmliZSIsInByaXNtYU1vY2siLCJiZWZvcmVBbGwiLCJ3YWxsZXQiLCJjcmVhdGUiLCJmbiIsIm1vY2tSZXNvbHZlZFZhbHVlIiwibmFtZSIsInB1YmxpY0tleSIsImZpbmRNYW55IiwiZmluZFVuaXF1ZSIsIm1vY2tJbXBsZW1lbnRhdGlvbiIsImFmdGVyRWFjaCIsImNsZWFyQWxsTW9ja3MiLCJ0ZXN0Iiwic29sYW5hIiwiY3JlYXRlV2FsbGV0Iiwia2V5Y2hhaW5SZWYiLCJnZXRQcml2YXRlS2V5IiwicmVzdWx0IiwiYWRkV2FsbGV0IiwiZXhwZWN0IiwidG9CZSIsImVtaXQiLCJ0b0hhdmVCZWVuQ2FsbGVkV2l0aCJdLCJzb3VyY2VzIjpbIndhcmNoZXN0LnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgd2FyY2hlc3QgPSByZXF1aXJlKCcuLi8uLi9zcmMvY29yZS93YXJjaGVzdCcpO1xuY29uc3QgZXZlbnRCdXMgPSByZXF1aXJlKCcuLi8uLi9zcmMvY29yZS9ldmVudEJ1cycpO1xuamVzdC5tb2NrKCcuLi8uLi9zcmMvY29yZS9zb2xhbmEnKTtcbmplc3QubW9jaygnLi4vLi4vc3JjL2NvcmUva2V5Y2hhaW4nKTtcblxuY29uc3QgeyBQcmlzbWFDbGllbnQgfSA9IHJlcXVpcmUoJ0BwcmlzbWEvY2xpZW50Jyk7XG5cbmRlc2NyaWJlKCdjb3JlIHdhcmNoZXN0JywgKCkgPT4ge1xuICBsZXQgcHJpc21hTW9jaztcblxuICBiZWZvcmVBbGwoKCkgPT4ge1xuICAgIHByaXNtYU1vY2sgPSB7XG4gICAgICB3YWxsZXQ6IHtcbiAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBuYW1lOiAnbmFtZScsIHB1YmxpY0tleTogJ3BrJyB9KSxcbiAgICAgICAgZmluZE1hbnk6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSksXG4gICAgICAgIGZpbmRVbmlxdWU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHB1YmxpY0tleTogJ3BrJyB9KVxuICAgICAgfVxuICAgIH07XG4gICAgUHJpc21hQ2xpZW50Lm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBwcmlzbWFNb2NrKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgdGVzdCgnYWRkV2FsbGV0IGVtaXRzIGV2ZW50IGFuZCByZXR1cm5zIHdhbGxldCcsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBzb2xhbmEgPSByZXF1aXJlKCcuLi8uLi9zcmMvY29yZS9zb2xhbmEnKTtcbiAgICBzb2xhbmEuY3JlYXRlV2FsbGV0Lm1vY2tSZXNvbHZlZFZhbHVlKHsgcHVibGljS2V5OiAncGsnLCBrZXljaGFpblJlZjogJ3JlZicgfSk7XG4gICAgc29sYW5hLmdldFByaXZhdGVLZXkubW9ja1Jlc29sdmVkVmFsdWUoJ3ByaXYnKTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB3YXJjaGVzdC5hZGRXYWxsZXQoJ25hbWUnKTtcbiAgICBleHBlY3QocmVzdWx0LnB1YmxpY0tleSkudG9CZSgncGsnKTtcbiAgICBleHBlY3QoZXZlbnRCdXMuZW1pdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3dhbGxldC5hZGQnLCB7IG5hbWU6ICduYW1lJywgcHVibGljS2V5OiAncGsnIH0pO1xuICB9KTtcbn0pOyJdLCJtYXBwaW5ncyI6IkFBRUFBLFdBQUEsR0FBS0MsSUFBSSxDQUFDLHVCQUF1QixDQUFDO0FBQ2xDRCxXQUFBLEdBQUtDLElBQUksQ0FBQyx5QkFBeUIsQ0FBQztBQUFDLFNBQUFELFlBQUE7RUFBQTtJQUFBRTtFQUFBLElBQUFDLE9BQUE7RUFBQUgsV0FBQSxHQUFBQSxDQUFBLEtBQUFFLElBQUE7RUFBQSxPQUFBQSxJQUFBO0FBQUE7QUFIckMsTUFBTUUsUUFBUSxHQUFHRCxPQUFPLENBQUMseUJBQXlCLENBQUM7QUFDbkQsTUFBTUUsUUFBUSxHQUFHRixPQUFPLENBQUMseUJBQXlCLENBQUM7QUFJbkQsTUFBTTtFQUFFRztBQUFhLENBQUMsR0FBR0gsT0FBTyxDQUFDLGdCQUFnQixDQUFDO0FBRWxESSxRQUFRLENBQUMsZUFBZSxFQUFFLE1BQU07RUFDOUIsSUFBSUMsVUFBVTtFQUVkQyxTQUFTLENBQUMsTUFBTTtJQUNkRCxVQUFVLEdBQUc7TUFDWEUsTUFBTSxFQUFFO1FBQ05DLE1BQU0sRUFBRVQsSUFBSSxDQUFDVSxFQUFFLENBQUMsQ0FBQyxDQUFDQyxpQkFBaUIsQ0FBQztVQUFFQyxJQUFJLEVBQUUsTUFBTTtVQUFFQyxTQUFTLEVBQUU7UUFBSyxDQUFDLENBQUM7UUFDdEVDLFFBQVEsRUFBRWQsSUFBSSxDQUFDVSxFQUFFLENBQUMsQ0FBQyxDQUFDQyxpQkFBaUIsQ0FBQyxFQUFFLENBQUM7UUFDekNJLFVBQVUsRUFBRWYsSUFBSSxDQUFDVSxFQUFFLENBQUMsQ0FBQyxDQUFDQyxpQkFBaUIsQ0FBQztVQUFFRSxTQUFTLEVBQUU7UUFBSyxDQUFDO01BQzdEO0lBQ0YsQ0FBQztJQUNEVCxZQUFZLENBQUNZLGtCQUFrQixDQUFDLE1BQU1WLFVBQVUsQ0FBQztFQUNuRCxDQUFDLENBQUM7RUFFRlcsU0FBUyxDQUFDLE1BQU07SUFDZGpCLElBQUksQ0FBQ2tCLGFBQWEsQ0FBQyxDQUFDO0VBQ3RCLENBQUMsQ0FBQztFQUVGQyxJQUFJLENBQUMsMENBQTBDLEVBQUUsWUFBWTtJQUMzRCxNQUFNQyxNQUFNLEdBQUduQixPQUFPLENBQUMsdUJBQXVCLENBQUM7SUFDL0NtQixNQUFNLENBQUNDLFlBQVksQ0FBQ1YsaUJBQWlCLENBQUM7TUFBRUUsU0FBUyxFQUFFLElBQUk7TUFBRVMsV0FBVyxFQUFFO0lBQU0sQ0FBQyxDQUFDO0lBQzlFRixNQUFNLENBQUNHLGFBQWEsQ0FBQ1osaUJBQWlCLENBQUMsTUFBTSxDQUFDO0lBQzlDLE1BQU1hLE1BQU0sR0FBRyxNQUFNdEIsUUFBUSxDQUFDdUIsU0FBUyxDQUFDLE1BQU0sQ0FBQztJQUMvQ0MsTUFBTSxDQUFDRixNQUFNLENBQUNYLFNBQVMsQ0FBQyxDQUFDYyxJQUFJLENBQUMsSUFBSSxDQUFDO0lBQ25DRCxNQUFNLENBQUN2QixRQUFRLENBQUN5QixJQUFJLENBQUMsQ0FBQ0Msb0JBQW9CLENBQUMsWUFBWSxFQUFFO01BQUVqQixJQUFJLEVBQUUsTUFBTTtNQUFFQyxTQUFTLEVBQUU7SUFBSyxDQUFDLENBQUM7RUFDN0YsQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDIiwiaWdub3JlTGlzdCI6W119